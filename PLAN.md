# Excess - 基本機能改善計画

## 現在の実装状況

### ✅ 完成済み機能
- 4つのコアモデル (Table, View, Function, Layout)
- IndexedDB永続化
- サイドバーナビゲーション
- テーブル編集（セル編集、列追加/削除、行追加/削除）
- CSV取り込み
- View のSQLクエリ実行
- Function のサンドボックス実行
- FN.functionName() によるView内での関数呼び出し
- セルの範囲選択、コピー＆ペースト
- Undo/Redo機能
- Layout へのドラッグ＆ドロップ配置

## 優先度1: 基本機能の不具合修正

### 1.1 データの整合性
**問題**: 列名変更時にデータキーが更新されない場合がある
- [ ] 列名変更時の全データ更新処理の確認
- [ ] 既存データのマイグレーション処理
- [ ] データキー不整合の自動検出・修復

### 1.2 View実行の安定性
**問題**: クエリエラー時のエラーメッセージが不親切
- [x] エラーメッセージの詳細化（行番号、カラム位置）
- [ ] クエリ構文のハイライト
- [ ] サポートされていない構文の明確な警告

### 1.3 Function実行の改善
**問題**: 関数エラー時にデバッグが困難
- [x] 関数実行時のエラー行番号表示
- [x] console.log のサポート（デバッグ用）
- [x] 実行結果のプレビュー機能

## 優先度2: 必須のデータ操作機能

### 2.1 テーブル構造の詳細設定
**現状**: 基本的な列定義のみ
- [ ] 複合プライマリキーの設定
- [ ] 複合ユニーク制約の設定
- [ ] インデックスの作成・管理
- [ ] テーブル編集ダイアログの実装
- [ ] 制約違反のバリデーション

### 2.2 データエクスポート
**現状**: CSVインポートのみ、エクスポート不可
- [x] CSV エクスポート
- [x] TSV エクスポート（Excel互換）
- [x] JSON エクスポート（プロジェクト全体のバックアップ）
- [ ] 選択範囲のみのエクスポート

### 2.3 テーブルのソート・フィルタ
**現状**: ソート・フィルタ機能なし
- [x] 列ヘッダクリックでソート（昇順/降順）
- [x] 簡易フィルタ入力欄
- [ ] ソート・フィルタ状態の保持
- [x] フィルタのクリアボタン

### 2.4 検索と置換
**現状**: テーブル内検索不可
- [x] Ctrl+F で検索ダイアログ
- [x] 検索結果のハイライト
- [x] 置換機能（選択範囲/全体）
- [x] 大文字小文字の区別オプション

## 優先度3: 操作性の向上

### 3.1 キーボード操作の完全対応
**現状**: 一部キーボード操作のみ
- [x] 矢印キーでのセル移動
- [x] Tab/Shift+Tab での横移動
- [x] Enter での縦移動と編集確定
- [x] F2 でセル編集開始
- [x] Delete で選択範囲のクリア

### 3.2 列幅の調整
**現状**: 固定幅
- [x] 列境界ドラッグでのリサイズ
- [x] ダブルクリックで自動幅調整
- [ ] 列幅の保存と復元

### 3.3 行番号とヘッダーの固定
**現状**: スクロール時に見づらい
- [ ] 行番号列の固定表示
- [x] ヘッダー行の固定（スクロール時も表示）
- [ ] 選択行・列のハイライト強化

## 優先度4: データ型と検証

### 4.1 データ型の改善
**現状**: 基本型のみ（string, number, boolean）
- [ ] 日付型のサポート
- [ ] 時刻型のサポート
- [ ] データ型の自動推論改善
- [ ] 型変換の明示的なUI

### 4.2 入力検証
**現状**: 検証なし
- [ ] 数値範囲の制限
- [ ] 必須項目の設定
- [ ] パターンマッチング（正規表現）
- [ ] エラー表示の改善

## 優先度5: パフォーマンスと安定性

### 5.1 大規模データ対応
**現状**: 大量データで遅い
- [ ] 仮想スクロール実装
- [ ] 遅延読み込み
- [ ] ページネーション オプション

### 5.2 自動保存とリカバリ
**現状**: 手動保存のみ
- [ ] 自動保存（変更時）
- [ ] 作業内容の自動バックアップ
- [ ] クラッシュ時のリカバリ

### 5.3 エラーハンドリング
**現状**: エラー時にアプリが停止する場合がある
- [ ] エラーバウンダリの実装
- [ ] 部分的な機能停止（全体は継続）
- [ ] エラーレポート機能

## 実装順序

1. **第1段階**（1週間）: 不具合修正（優先度1）
2. **第2段階**（2週間）: 必須機能（優先度2）  
3. **第3段階**（1週間）: 操作性（優先度3）
4. **第4段階**（1週間）: データ型（優先度4）
5. **第5段階**（1週間）: 安定性（優先度5）

## 設計原則の維持

- **Excelではない**: セル単位の数式（=A1+B1）は使わない
- **Function中心**: 再利用可能な関数で計算
- **セキュアサンドボックス**: 関数は隔離環境で実行
- **シンプルさ重視**: 複雑な機能より基本機能の完成度